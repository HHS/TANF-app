{% load i18n admin_urls %}
<h3>{% blocktrans with filter_title=title %} By {{ filter_title }} {% endblocktrans %}</h3>

<ul>
    {% for choice in choices|slice:":1" %}
        <li{% if choice.selected %} class="selected"{% endif %}>
            <a href="{{ choice.query_string|iriencode }}" title="Show {{ choice.display }}">Show {{ choice.display }}</a>
        </li>
    {% endfor %}
    <li>
        <select id="{{ title|slugify }}_select" multiple style="color:#000000;width:100%" aria-mutliselectable="true">
        {% for choice in choices|slice:"1:" %}
            <option{% if choice.selected %} selected{% endif %}
                value="{{ choice.value }}"
                data-key="{{ choice.key }}"
                data-query="{{ choice.query_string|iriencode }}"
                style="color:#000000"
                {% if choice.selected %} aria-checked="true" {% else %} aria-checked="false" {% endif %}>
                {{ choice.display }}
            </option>
        {% endfor %}
        </select>
    </li>
    <li>
        <input type="submit" value="Filter to Selection(s)" title="Filter to Selection(s)" id="{{ title|slugify }}_submit"/>
    </li>
</ul>

<script>
(function($) {
    $('input#{{ title|slugify }}_submit').click(function(evt) {
        // fetch data from selected options
        var params = {};
        var query = null;
        $('select#{{ title|slugify }}_select > option:selected').each(function() {
            var key = $(this).attr('data-key');
            if (! params.hasOwnProperty(key)) params[key] = [];
            params[key].push($(this).val());
            if (!query) query = $(this).attr('data-query');
        });

        // do we had selected options at all?
        if (!query) return false;

        // build up the href
        var params_query = '';
        for (var key in params) {
            if (params.hasOwnProperty(key)) {
                params_query += '&' + key + '=' + params[key].join()
            }
        }
        window.location = query + params_query;
    });
})(django.jQuery);
</script>
